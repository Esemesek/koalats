{"version":3,"file":"bundle.umd.js","sources":["../src/error/CircularDependencyError.ts","../src/error/ComponentAlreadyExistError.ts","../src/error/ComponentNotFoundError.ts","../src/service/IoCService.ts","../src/decorator/Bootstrap.ts","../src/decorator/Component.ts","../src/decorator/Inject.ts","../src/service/InjectorService.ts","../src/index.ts"],"sourcesContent":["export default class CircularDependencyError extends Error {\r\n  constructor() {\r\n    super('There is cycle in dependencies');\r\n  }\r\n}\r\n","export default class ComponentAlreadyExistError extends Error {\r\n  constructor(name: string) {\r\n    super(`Component '${name}' already exists in container`);\r\n  }\r\n}\r\n","export default class ComponentNotFoundError extends Error {\r\n  constructor(name: string) {\r\n    super(`Component '${name}' does not exist in container`);\r\n  }\r\n}\r\n","import CircularDependencyError from '../error/CircularDependencyError';\r\nimport ComponentAlreadyExistError from '../error/ComponentAlreadyExistError';\r\nimport ComponentNotFoundError from '../error/ComponentNotFoundError';\r\n\r\ninterface ComponentMap {\r\n  [name: string]: Object;\r\n}\r\n\r\nexport interface ConstructorMap {\r\n  [name: string]: {\r\n    componentConstructor: any;\r\n    dependencies: Array<string>;\r\n  }\r\n}\r\n\r\nexport default class IoCService {\r\n  private static instance = new IoCService();\r\n  private registeredComponents: ConstructorMap = {};\r\n  private components: ComponentMap = {};\r\n\r\n  constructor() {\r\n    return IoCService.instance;\r\n  }\r\n\r\n  public static getInstance = (): IoCService => IoCService.instance;\r\n\r\n  public startContainer = () => {\r\n    if (this.areDepsCyclic()) {\r\n      throw new CircularDependencyError();\r\n    }\r\n\r\n    this.createDependencies();\r\n  }\r\n\r\n  public registerComponent = (name: string, componentConstructor: any, dependencies: Array<string>): void => {\r\n    if (this.registeredComponents[name] !== undefined) {\r\n      throw new ComponentAlreadyExistError(name);\r\n    }\r\n\r\n    this.registeredComponents[name] = {\r\n      componentConstructor,\r\n      dependencies,\r\n    };\r\n  }\r\n\r\n  public getComponent = (name: string): any => {\r\n    const component = this.components[name];\r\n    if (component === undefined) {\r\n      throw new ComponentNotFoundError(name);\r\n    }\r\n\r\n    return component;\r\n  }\r\n\r\n  private createDependencies = () => Object.keys(this.registeredComponents).forEach(this.createDependency);\r\n\r\n  private createNodeDependencies = (key: string) => {\r\n    this.registeredComponents[key].dependencies.forEach(this.createDependency)\r\n  }\r\n\r\n  private createDependency = (dep: string) => {\r\n    if (this.components[dep] === undefined) {\r\n      if (this.registeredComponents[dep].dependencies.length > 0) {\r\n        this.createNodeDependencies(dep);\r\n      }\r\n\r\n      this.components[dep] = new this.registeredComponents[dep].componentConstructor(\r\n        ...this.getDependenciesFromContainer(this.registeredComponents[dep].dependencies)\r\n      );\r\n    }\r\n  }\r\n\r\n  private getDependenciesFromContainer = (dependencies: string[]) => {\r\n    return dependencies.map(this.getComponent);\r\n  }\r\n\r\n  private areDepsCyclic = () => {\r\n    return Object.keys(this.registeredComponents).some((key: string) => {\r\n      return this.registeredComponents[key].dependencies.includes(key)\r\n        || this.isCycleInNode(key, this.registeredComponents[key].dependencies);\r\n    })\r\n  }\r\n\r\n  private isCycleInNode = (key: string, dependencies: string[]): boolean => {\r\n    return dependencies.some((dep: string) => {\r\n      if (this.registeredComponents[dep] === undefined) {\r\n        throw new ComponentNotFoundError(dep);\r\n      }\r\n\r\n      return dependencies.includes(key)\r\n        || this.isCycleInNode(key, this.registeredComponents[dep].dependencies);\r\n    });\r\n  }\r\n}\r\n","import IoCService from '../service/IoCService';\r\n\r\nconst Bootstrap = (target: any) => {\r\n  if (target.initialize instanceof Function) {\r\n    target.initialize();\r\n  }\r\n\r\n  IoCService.getInstance().startContainer();\r\n\r\n  target.main();\r\n}\r\n\r\nexport default Bootstrap;\r\n","import IoCService from '../service/IoCService';\r\n\r\nconst Component = ({ name, dependencies = [] }: { name: string, dependencies?: string[] }) => {\r\n  return (target: any) => {\r\n    IoCService.getInstance().registerComponent(name, target, dependencies);\r\n  }\r\n}\r\n\r\nexport default Component;\r\n","import IoCService from '../service/IoCService';\r\n\r\nconst Inject = (name: string) => (target: any, key: string) => {\r\n  const get = () => IoCService.getInstance().getComponent(name);\r\n\r\n  Reflect.defineProperty(target, key, {\r\n    get,\r\n  });\r\n}\r\n\r\nexport default Inject;\r\n","import IoCService from './IoCService';\r\n\r\nexport default class InjectorServiceService {\r\n  static get = <T>(name: string): T => IoCService.getInstance().getComponent(name);\r\n}\r\n","import Bootstrap from './decorator/Bootstrap';\r\nimport Component from './decorator/Component';\r\nimport Inject from './decorator/Inject';\r\nimport InjectorService from './service/InjectorService';\r\n\r\nexport default {\r\n  Bootstrap,\r\n  Component,\r\n  Inject,\r\n  InjectorService\r\n};\r\n"],"names":[],"mappings":"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"}